# TimeXer-Official 模型配置文件（基于官方架构）
# 版本: v0.6
# 日期: 20260206

metadata:
  version: "v0.6"
  date: "20260206"
  description: "TimeXer-Official适配器配置 - 使用官方TimeXer架构 + 你的数据流"

model:
  name: "timexer_official"
  
  # 输入输出维度
  seq_len: 500          # 输入序列长度（必须能被patch_len整除）
  n_features: 64        # 总特征数量（会自动检测并更新）
  prediction_len: 1     # 预测长度（输出维度）
  
  # 内生变量配置
  endogenous_index: 2   # 内生变量在特征中的索引位置（0-based，2=第3个特征，即"收盘"）
                        # 其他所有特征自动成为外生变量
  
  # 官方TimeXer架构参数
  patch_len: 25         # Patch大小（seq_len必须能被patch_len整除）
                        # seq_len=500, patch_len=25 → patch_num=20
  d_model: 64           # 模型嵌入维度
  n_heads: 8            # 注意力头数
  e_layers: 2           # Encoder层数
  d_ff: 256             # FFN隐藏维度
  dropout: 0.1          # Dropout比率
  activation: "gelu"    # 激活函数: "gelu" 或 "relu"
  use_norm: true        # 是否使用Instance Normalization
  norm_feature_indices: null  # 所有数据按列归一化
  # norm_feature_indices: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  # 需要归一化的特征索引列表（索引1-10，即第2-11个特征）

# 架构说明：
# ========== 官方TimeXer核心组件 ==========
# 1. 内生变量表示（Patch-Level）：
#    - 输入：[B, 1, 500] 单个内生变量
#    - Patching：切分为20个patches，每个长度25
#    - Value Embedding + Position Embedding
#    - Global Token：可学习的全局token
#    - 输出：[B*1, 21, d_model] = [B, 21, 64]
#
# 2. 外生变量表示（Variate-Level）：
#    - 输入：[B, 500, 63] = 其他63个特征
#    - 转置：[B, 63, 500]
#    - Linear投影：每个变量的完整时间序列 → d_model
#    - 输出：[B*63, 1, d_model] = [B*63, 1, 64]
#
# 3. Encoder（2层）：
#    每层包含：
#    - Patch-wise Self-Attention：内生patches之间的注意力
#    - Variate-wise Cross-Attention：Global Token关注外生变量
#    - Feed-Forward Network（Conv1D实现）
#
# 4. FlattenHead：
#    - 输入：[B, 1, d_model, patch_num+1] = [B, 1, 64, 21]
#    - Flatten：[B, 1, 64*21] = [B, 1, 1344]
#    - Linear投影：1344 → prediction_len
#    - 输出：[B, 1, 1]
#
# ========== 适配你的数据流 ==========
# - 输入格式：[B, 500, 64] + mask
# - 缺失值处理：学习型Missing Embedding（替换-1000）
# - Instance Normalization：可选，与v0.43保持一致
# - 特征分离：
#   * 内生：索引2（第3个特征，即"收盘"）
#   * 外生：其他63个特征
# - 输出格式：[B, 1] 单步预测
# - 反归一化：对内生变量还原

# v0.6版本特性：
# - 使用官方TimeXer的核心架构（Patch-Level + Variate-Level + Global Token）
# - 保留学习型Missing Embedding
# - 保持数据流接口不变（输入/输出/mask）
# - 支持指定单一内生变量（当前索引2="收盘"）
# - patch_len=25，适配500长度序列
